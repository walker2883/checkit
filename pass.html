<!DOCTYPE html PUBLIC"-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta http-equiv="content-type" />
  <title>WCAG CHECK IT</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script> -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap-theme.css" />
  <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />
</head>
<body>
  <style>
    body {
      padding: 10px;
    }
    img {
      margin: auto;
      display: block;
    }
    .panel-body {
      overflow-x: scroll;
    }
    .panel-group {
      margin: 0 0 5px 0;
    }
    .panel-heading {
      padding: 0;
    }
    .panel-title a {
      display: block;
      width: 100%;
      padding: 10px 15px;
      transition: 0.1s all linear;
    }
    .panel-title a:hover {
      background: #EEEEEE;
      transition: 0.1s all linear;
    }
    xmp {
      white-space: inherit;
      margin: 0px;
    }
    .table {
      max-width:100%;
      width: 100%;
      margin: auto;
      word-wrap: break-word;
    }
    .gtp {
      float: right
    }
  </style>
  <div id="test" class="container"></div>
  <script type="text/javascript">
    $.ajaxSetup({
      beforeSend: function(xhr) {
        if (xhr.overrideMimeType) {
          xhr.overrideMimeType("application/json");
        }
      }
    });
    $(document).ready(function() {
      var jqXHR = $.get("accessibility_report.json", {}, function(data) {
        var dataOut = "";
        var dataImage = "";
        var dataSummary = "";
        var dataSummaryFormatted = "";
        var dataQuantity = 0;
        var dataIndex = 0;
        var dataNames = [];
        var dataIssues = [];
        var dataIssuesTotal = 0;
        var dataHeadings = [];
        var dataDescriptions = [];
        var dataNodes = [];
        var dataNid = [];
        var dataNids = [];
        var dataNidTotal = 0;
        var dataWebsite;
        var issue;
        var heading;
        var description;
        var element;
        var node;
        for (item in data) {
          dataNames[dataQuantity] = item;
          dataQuantity++;
        }
        for (nid in dataNames) {
          dataNid = dataNames[nid].replace("node_", "");
          dataItem = data[dataNames[nid]];
          dataQuantityIssues = data[dataNames[nid]].length;
          dataIssuesTotal += dataQuantityIssues;
          dataNidTotal++;
          dataIssues[nid] += dataNames[0][0].issue;
          dataWebsite = dataItem[0].website;
          dataOut += "<div class='panel-group' id='accordion-" + dataNid + "' role='tablist' aria-multiselectable='true'>";
          dataOut += "<div class='panel panel-default'>";
          dataOut += "<div class='panel-heading' role='tab' id='heading-" + dataNid + "'>";
          dataOut += "<h4 class='panel-title'>";
          dataOut += "<a role='button' data-toggle='collapse' data-parent='#accordion' href='#collapse-" + dataNid + "' aria-expanded='true' aria-controls='collapse-" + dataNid + "'>Node #" + dataNid + "</a>";
          dataOut += "</h4>";
          dataOut += "</div>";
          dataOut += "<div id='collapse-" + dataNid + "' class='panel-collapse collapse' role='tabpanel' aria-labelledby='heading-" + dataNid + "'>";
          dataOut += "<div class='panel-body'>";
          dataOut += "<table class='table table-bordered table-hover table-condensed'>";
          dataOut += "<tr class='active'><td colspan='2'>Node #" + dataNid + "<br />" + dataQuantityIssues + " issues were found</td><td colspan='2'><a class='btn btn-success gtp' href='http://" + dataWebsite + "/node/" + dataNid + "'>go to page</a></td></tr>";
          for (dataIndex = 0; dataIndex < dataQuantityIssues; dataIndex++) {
            dataItem = data[dataNames[nid]][dataIndex];
            dataItem.rowClass = "";
            dataIssues[dataIndex] = dataItem.issue;
            dataHeadings[dataIndex] = dataItem.heading;
            dataDescriptions[dataIndex] = dataItem.description;
            dataNodes[dataIndex] = dataItem.element.node;
            if (dataHeadings[dataIndex] == "ERROR") { dataItem.rowClass = "danger"; }
            dataOut += "<tr class='" + dataItem.rowClass + "'>";
            dataOut += "<td class='heading " + dataHeadings[dataIndex] + "'>" + dataHeadings[dataIndex] + "</td>";
            dataOut += "<td class='issue'>" + dataIssues[dataIndex] + "</td>";
            dataOut += "<td class='description'>" + dataDescriptions[dataIndex] + "</td>";
            dataOut += "<td class='nodes'>" + dataNodes[dataIndex].replace(/(<([^>]+)>)/ig,"") + "</td>";
            dataOut += "</tr>";
          }
          dataOut += "</table>";
          dataOut += "</div>";
          dataOut += "</div>";
          dataOut += "</div>";
          dataOut += "</div>";
        }
        dataImage = "<img src='./images/checkit.gif' />";
        dataImage += "<p>&nbsp;</p>";
        dataSummary += "<p class='alert alert-danger'>" + dataNidTotal + " nodes have accessibility issues.</p>";
        dataSummary += "<p class='alert alert-danger'>" + dataIssuesTotal + " issues in total have been identified.</p>";
        dataSummaryFormatted += "<div class='row container'>";
        dataSummaryFormatted += "<div class='col-lg-6 col-md-6 col-sm-12 col-xs-12'>";
        dataSummaryFormatted += dataImage;
        dataSummaryFormatted += "</div>";
        dataSummaryFormatted += "<div class='col-lg-6 col-md-6 col-sm-12 col-xs-12'>";
        dataSummaryFormatted += "<p>&nbsp;</p>";
        dataSummaryFormatted += "<p>&nbsp;</p>";
        dataSummaryFormatted += "<p>&nbsp;</p>";
        dataSummaryFormatted += dataSummary;
        dataSummaryFormatted += "</div>";
        dataSummaryFormatted += "</div>";
        document.getElementById('test').innerHTML = dataSummaryFormatted + dataOut;
        }).fail(function( jqxhr, textStatus, error ) {
          var err = textStatus + ', ' + error;
          console.log( "Request Failed: " + err);
        });
    });
  </script>
</body>
</html>
