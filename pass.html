<!DOCTYPE html PUBLIC"-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta http-equiv="content-type" />
  <title>WCAG CHECK IT</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script> -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap-theme.css">
  <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
</head>
<body>
  <style>
    body {
      padding: 10px;
    }
    img {
      margin: auto;
      display: block;
    }
  </style>
  <div id="test" class="container"></div>
  <style>
    xmp {
      white-space: inherit;
      margin: 0px;
    }
    .table {
      width: 100%;
      word-wrap: break-word;
    }
    .gtp {
      float: right
    }
  </style>
  <script type="text/javascript">
    $.ajaxSetup({
      beforeSend: function(xhr) {
        if (xhr.overrideMimeType) {
          xhr.overrideMimeType("application/json");
        }
      }
    });
    $(document).ready(function() {
      var jqXHR = $.get("accessibility_report.json", {}, function(data) {
        var dataOut = "";
        var dataImage;
        var dataSummary;
        var dataQuantity = 0;
        var dataIndex = 0;
        var dataNames = [];
        var dataIssues = [];
        var dataIssuesTotal = 0;
        var dataHeadings = [];
        var dataDescriptions = [];
        var dataNodes = [];
        var dataNid = [];
        var dataNids = [];
        var dataNidTotal = 0;
        var dataWebsite;
        var issue;
        var heading;
        var description;
        var element;
        var node;
        for (item in data) {
          dataNames[dataQuantity] = item;
          dataQuantity++;
        }
        dataOut += "<div cols='4' class='row container'><table class='table table-bordered table-hover table-condensed'>";
        for (nid in dataNames) {
          dataQuantityIssues = data[dataNames[nid]].length;
          dataIssuesTotal += dataQuantityIssues;
          dataNidTotal++;
          dataNid = dataNames[nid].replace("node_", "");
          dataIssues[nid] += dataNames[0][0].issue;
          // dataWebsite = dataNames[data[dataNames[nid]].length].website;
          dataOut += "<tr class='active'><td colspan='2'>Node #" + dataNid + dataWebsite +  "<br />" + dataQuantityIssues + " issues were found</td><td colspan='2'><a class='disabled btn btn-success gtp' href='/node/" + dataNid + "'>go to page</a></td></tr>";
          for (dataIndex = 0; dataIndex < dataQuantityIssues; dataIndex++) {
            dataItem = data[dataNames[nid]][dataIndex];
            dataItem.rowClass = "";
            dataIssues[dataIndex] = dataItem.issue;
            dataHeadings[dataIndex] = dataItem.heading;
            dataDescriptions[dataIndex] = dataItem.description;
            dataNodes[dataIndex] = dataItem.element.node;
            if (dataHeadings[dataIndex] == "ERROR") { dataItem.rowClass = "danger"; }
            dataOut += "<tr class='" + dataItem.rowClass + "'>";
            dataOut += "<td class='heading " + dataHeadings[dataIndex] + "'>" + dataHeadings[dataIndex] + "</td>";
            dataOut += "<td class='issue'>" + dataIssues[dataIndex] + "</td>";
            dataOut += "<td class='description'>" + dataDescriptions[dataIndex] + "</td>";
            dataOut += "<td class='nodes'>" + dataNodes[dataIndex].replace(/(<([^>]+)>)/ig,"") + "</td>";
            dataOut += "</tr>";
          }
        }
        dataOut += "</table></row>";
        dataImage = "<div class='row container'><img src='./images/checkit.gif' /></div>";
        dataSummary = "<div class='row container'>";
        dataSummary += "<p class='alert alert-danger'>" + dataNidTotal + " nodes have accessibility issues.</p>";
        dataSummary += "<p class='alert alert-danger'>" + dataIssuesTotal + " issues in total have been identified.</p>";
        dataSummary += "</div>";
        document.getElementById('test').innerHTML =  dataImage + dataSummary + dataOut;
        }).fail(function( jqxhr, textStatus, error ) {
          var err = textStatus + ', ' + error;
          console.log( "Request Failed: " + err);
        });
    });
  </script>
</body>
</html>
